<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Luminosite - dev version</title>
  <link rel="stylesheet" href="luminosite.css">
  <style>body{display:flex;align-items:center;justify-content:center;height:100vh;background:#fafafa;margin:0}</style>
</head>
<body>

<div id="widget-luminosite-standalone" class="widget widget-luminosite">
  <div class="widget-content-vertical">
    <div class="info-container">
      <div class="widget-titre">Luminosité (dev)</div>
      <div class="widget-valeur" id="valeur-luminosite">-- <span class="unite">lux</span></div>
      <div class="widget-source" id="source-luminosite">source : local</div>
    </div>

    <div class="lumino-container">
      <div class="lumino-fill" id="lumino-fill" style="width:0%;"></div>
    </div>
  </div>
</div>

<script>
(function(){
  const wrapper = document.getElementById('widget-luminosite-standalone');
  if(!wrapper) return;
  const widgetId = wrapper.id;
  window[widgetId] = {
    updateValue: function(valeur, timestamp){
      console.log('updateValue luminosity', valeur, timestamp, widgetId);
      const fill = wrapper.querySelector('#lumino-fill');
      if(fill){
        const clamped = Math.min(Math.max(valeur, 0), 1000);
        const percentage = (clamped / 1000) * 100;
        fill.style.width = `${percentage}%`;
        if(valeur < 100){
          fill.style.background = 'linear-gradient(to right,#4A90E2,#50C8FF)';
        } else if(valeur < 500){
          fill.style.background = 'linear-gradient(to right,#F5A623,#F8E71C)';
        } else {
          fill.style.background = 'linear-gradient(to right,#FFD27A,#FF9E3B)';
        }
      }
    }
  };

  // Simulation : mise à jour toutes les 2s
  setInterval(()=>{
    const v = (Math.random()*1000).toFixed(2);
    window[widgetId].updateValue(Number(v), new Date().toISOString());
    // Mettre à jour l'affichage numérique
    const valEl = wrapper.querySelector('#valeur-luminosite');
    if(valEl) valEl.innerHTML = `${Number(v).toFixed(2)} <span class="unite">lux</span>`;
  },2000);
})();
</script>

</body>
</html>